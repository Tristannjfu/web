<!DOCTYPE HTML>
<html>
<head>

<title>websocket</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<link rel="stylesheet" type="text/css" href="" />
<script src="qunee-min.js"></script>

<script>
  var  ws = new WebSocket("ws://localhost:8080/web/websocket");  
  var message="hello";
  ws.onopen = function (evt) { onOpen(evt) }; 
  ws.onmessage = function (evt) { onMessage(evt) }; 
  ws.onerror = function (evt) { onError(evt) };
  
  function onOpen(evt) { 
		 console.log("Connected to WebSocket server."); 
	 }
  
  function onMessage(evt) {  
	  var num=evt.data;
	  console.log('Retrieved data from server: ' + evt.data);
	  document.getElementById('number').innerHTML = num;
	  draw(num);
	  }
  function onError(evt) { 
		 console.log('Error occured: ' + evt.data); 
	 }
  function send(evt) { 
		 ws.send("hello"); 
	 }
  function draw(num){
	  var graph = new Q.Graph('canvas');
	  var gw = graph.createNode("GetWay",0,-400);
	  gw.image="Q-server";
	  var ap = graph.createNode("Ap",0,-300);
	  ap.image="Q-server";
	  var edge1 = graph.createEdge("",gw,ap);
	  var i=1;
	  console.log(i);
	  var str=new Array(num+1);
	  for (i;i<=num;i++){
		  var str1="device"+i;
		  console.log(str);
		  str[i]=graph.createNode(str1,0,-300+100*i);
	 	 if(i==1){
	 		var edge = graph.createEdge("",ap,str[i]);
	 	 }
	 	 else{
	 		var edge = graph.createEdge("",str[i-1],str[i]);
	 	 }
  }
}
</script>
</head>
 <body>
 <h1>the device number is <span id="number">*</span></h1>
 <a href="javascript:send()">click</a>
<div style="height: 1000px;" id="canvas"/>
 </body>
 </html>